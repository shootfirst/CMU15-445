# CMU15-445
卡内基梅隆大学2021秋数据库实验

lab0直接跳过，因为自认为有一点cpp基础，加之前面两个实验(cs144和cs143)也是cpp写的，并且并没有发现写实验需要对cpp掌握很深。

## lab1

实验1是手撸一个内存池。如果有os基础的话，相信应该非常容易上手。只需看完CMU数据库视频buffer pool相关章节即可开始。实验被分成三个子任务。


### LRU REPLACEMENT POLICY

这个子任务是写一个lru算法替代类，一开始我觉得这个任务估计是最简单的，后面才发现玄学多着。

#### param out

cpp的这个注释我一开始是不知道的，输出参数。即虽然这个参数是传入的形参，但它是个指针变量，起到输出的作用，你需要将要输出的参数值写入此指针所指向的地址，是为输出参数。如victim
函数。起初我很疑惑，为啥这个函数删除的一个frameid，但是不返回呢？这样调用者怎么获得你删除的那个frameid呢，后面一看注释，才知道这个知识点。妙啊

#### 哈希表与链表结合实现对链表查找实现o1时间复杂度

为了实现lru算法，我使用链表按到来的先后顺序存储frameid，使用哈希表存储frameid和其在链表中的指针。这样我需要对链表中指定数据的删除时可以直接做到o1时间复杂度，而我要找到victim
也只需pop链表头，从哈希表中删除即可，时间复杂度也为o1，需要添加framid也只需要将其push到链表和加入哈希表（重复则不加），时间复杂度也为o1。这样可以大大减少时间开销。一开始我是
单纯使用哈希表存储frameid加时间戳，这样寻找victim的时间复杂度是on，线上测试内存这块会超时。

#### unpin

这个方法需要注意，当然你看本地的测试文件时也会得出这个结论。就是unpin多次同一个frameid时，时间应该以第一次unpin时为准，而不是最后一次


### BUFFER POOL MANAGER INSTANCE

这个算这个实验的核心与重点吧，下面分别介绍一些实现的函数思路

#### NewPgImp

虽然说注释给出了特别详细的信息步骤，但是你直接按注释写会死翘翘的。这个注释有一定没有提到，就是如果你找的是victim，那么，你必须对其进行脏判断，若是脏判断则必须写回，并且要将
脏标记改为不脏，还有一个就是要去page_table_中取消它们的映射！！！注意到这两个关键点后，在配合注释食用，那基本差不多了

#### 
